{%- include global_variables.html -%}

<div class="w-100">
  <nav class="navbar navbar-dark navbar-expand-lg background-primary d-flex flex-wrap flex-md-nowrap justify-content-between">
    {% comment %}
      XXX: Starting from medium screens this element is absolutely
      positioned so it's always centered even if the left dropdown menu
      grows.

      The content is hidden for screen readers so because the titlebar
      contains the full book title.
    {% endcomment %}
    <div class="w-100 position-md-absolute navbar-brand text-uppercase text-center pointer-event-none" aria-hidden="true">
      <a href="{{ '/' | relative_url }}" class="h4 white mb-0 text-decoration-none">
        {{ site.title }}
        {{ current_site_modifier | remove: ':' }}
      </a>
    </div>

    <div class="navbar-focus-within">
      <button class="navbar-toggler" type="button" aria-label="{{ t.navbar.label }}">
        <span class="navbar-toggler-icon"></span>
      </button>

      <div style="z-index: 1" class="collapse navbar-collapse position-absolute position-md-relative left-0 w-100 w-md-auto h-100vh h-md-auto background-primary">
        <div class="navbar-nav d-flex align-items-center">
          <div class="nav-item w-100 w-lg-auto">
            <a class="nav-link text-uppercase font-weight-bold h6 mb-0 white" href="{{ '/' | relative_url }}">
              {{ t.navbar.home }}
            </a>
          </div>

          {% comment %}
            Generate dropdown menus recursively
          {% endcomment %}
          {% for layout in site.book_layouts -%}
            {% assign posts = site.posts | where: 'layout', layout %}
            {% if posts == empty %}{% continue %}{% endif %}
            <div class="nav-item w-100 w-lg-auto">
              <div class="nav-link dropdown">
                <button
                  class="dropdown-toggle border-0 background-primary white text-uppercase font-weight-bold h6 mb-0"
                  type="button"
                  id="dropdown-{{ layout }}"
                  data-toggle="dropdown"
                  aria-haspopup="true"
                  aria-expanded="false">
                  {{ t.navbar[layout] }}
                </button>

                <div class="dropdown-menu background-primary" aria-labeledby="dropdown-{{ layout }}">
                  {% for post in posts %}
                    <a class="dropdown-item font-weight-bold white" href="{{ post.url | relative_url }}">{{ post.title }}</a>
                  {% endfor %}
                </div>
              </div>
            </div>
          {% endfor %}
        </div>
      </div>
    </div>

    <div class="nav-item">
      <div class="nav-link text-right">
        <label
          class="white text-uppercase font-weight-bold h6 mb-0"
          for="search-toggler"
          id="search-label">
          {{ t.navbar.search }}
          <i class="fa fa-fw fa-search" aria-hidden="true"></i>
        </label>

        <input type="checkbox" name="search-toggler" id="search-toggler" class="toggler sr-only" />
        <div class="toggled">
          <label class="background-white-t2 position-fixed top-0 left-0 h-100vh w-100" for="search-toggler">
          </label>

          <div class="text-left background-primary p-3 position-fixed top-navbar right-0" aria-labeledby="dropdown-search">
            {% include_cached search.html t=t %}
          </div>
        </div>
      </div>
    </div>
  </nav>
</div>
